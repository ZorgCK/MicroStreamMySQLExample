
package com.company.microstreammysql.ui;

import java.io.IOException;
import java.util.List;

import com.company.microstreammysql.entities.Customer;
import com.company.microstreammysql.microstream.MicroStream;
import com.google.gson.JsonIOException;
import com.google.gson.JsonSyntaxException;
import com.rapidclipse.framework.server.resources.CaptionUtils;
import com.vaadin.flow.component.ClickEvent;
import com.vaadin.flow.component.ComponentEvent;
import com.vaadin.flow.component.ComponentEventListener;
import com.vaadin.flow.component.button.Button;
import com.vaadin.flow.component.grid.Grid;
import com.vaadin.flow.component.orderedlayout.VerticalLayout;
import com.vaadin.flow.router.Route;
import com.vaadin.flow.server.InitialPageSettings;
import com.vaadin.flow.server.PageConfigurator;


@Route("")
public class MainLayout extends VerticalLayout implements PageConfigurator
{
	public MainLayout()
	{
		super();
		this.initUI();
	}

	@Override
	public void configurePage(final InitialPageSettings settings)
	{
		settings.addLink("shortcut icon", "frontend/images/favicon.ico");
		settings.addFavIcon("icon", "frontend/images/favicon256.png", "256x256");
	}

	/**
	 * Event handler delegate method for the {@link Button} {@link #button2}.
	 *
	 * @see ComponentEventListener#onComponentEvent(ComponentEvent)
	 * @eventHandlerDelegate Do NOT delete, used by UI designer!
	 */
	private void button2_onClick(final ClickEvent<Button> event)
	{
		try
		{
			final List<Customer> loadCustomers = DataSourceUtils.loadCustomers();
			MicroStream.root().getCustomers().addAll(loadCustomers);
			MicroStream.storageManager().store(MicroStream.root().getCustomers());

			this.grid.setItems(MicroStream.root().getCustomers());
		}
		catch(final JsonSyntaxException | JsonIOException | IOException e)
		{
			e.printStackTrace();
		}
	}

	/* WARNING: Do NOT edit!<br>The content of this method is always regenerated by the UI designer. */
	// <generated-code name="initUI">
	private void initUI()
	{
		this.button2 = new Button();
		this.grid    = new Grid<>(Customer.class, false);

		this.button2.setText("Load Data");
		this.grid.addColumn(Customer::getId).setKey("id").setHeader(CaptionUtils.resolveCaption(Customer.class, "id"))
			.setSortable(true);
		this.grid.addColumn(Customer::getFirstname).setKey("firstname")
			.setHeader(CaptionUtils.resolveCaption(Customer.class, "firstname")).setSortable(true);
		this.grid.addColumn(Customer::getLastname).setKey("lastname")
			.setHeader(CaptionUtils.resolveCaption(Customer.class, "lastname")).setSortable(true);
		this.grid.addColumn(Customer::getGender).setKey("gender")
			.setHeader(CaptionUtils.resolveCaption(Customer.class, "gender")).setSortable(true);
		this.grid.addColumn(Customer::getMail).setKey("mail")
			.setHeader(CaptionUtils.resolveCaption(Customer.class, "mail"))
			.setSortable(true);
		this.grid.addColumn(Customer::getIpAddress).setKey("ipAddress")
			.setHeader(CaptionUtils.resolveCaption(Customer.class, "ipAddress")).setSortable(true);
		this.grid.setSelectionMode(Grid.SelectionMode.SINGLE);

		this.button2.setSizeUndefined();
		this.grid.setSizeFull();
		this.add(this.button2, this.grid);
		this.setFlexGrow(1.0, this.grid);
		this.setSizeFull();

		this.button2.addClickListener(this::button2_onClick);
	} // </generated-code>

	// <generated-code name="variables">
	private Grid<Customer> grid;
	private Button         button2;
	// </generated-code>

}
